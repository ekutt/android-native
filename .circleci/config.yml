version: 2.1

orbs:
  android: circleci/android@0.2.1

jobs:
  build:
    docker:
      - image: circleci/android:api-28-ndk

    steps:
      - checkout

      - run:
          command: ./gradlew build
          #connectedAndroidTest
#################################################
    test:
      override:
        # start the emulator
        - emulator -avd circleci-android28 -no-audio -no-window:
            background: true
            parallel: true
        # wait for it to have booted
        - circle-android wait-for-boot
        # unlock the emulator screen
        - sleep 30
        - adb shell input keyevent 82
          # run tests  against the emulator.
        - ./gradlew connectedAndroidTest

